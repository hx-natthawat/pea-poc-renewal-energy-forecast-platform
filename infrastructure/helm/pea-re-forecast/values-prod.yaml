# Production environment values

global:
  namespace: pea-forecast-prod

backend:
  replicaCount: 3
  env:
    APP_ENV: production
  resources:
    requests:
      memory: "1Gi"
      cpu: "1000m"
    limits:
      memory: "4Gi"
      cpu: "4000m"
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilization: 60
    targetMemoryUtilization: 70

frontend:
  replicaCount: 3
  resources:
    requests:
      memory: "256Mi"
      cpu: "200m"
    limits:
      memory: "1Gi"
      cpu: "1000m"
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilization: 60

timescaledb:
  persistence:
    enabled: true
    size: 200Gi
    storageClass: "longhorn"
  resources:
    requests:
      memory: "8Gi"
      cpu: "2000m"
    limits:
      memory: "24Gi"
      cpu: "6000m"
  auth:
    existingSecret: "timescaledb-credentials"

redis:
  persistence:
    enabled: true
    size: 10Gi
    storageClass: "longhorn"
  resources:
    requests:
      memory: "256Mi"
      cpu: "200m"
    limits:
      memory: "1Gi"
      cpu: "500m"
  config:
    maxmemory: "1gb"
    maxmemoryPolicy: "allkeys-lru"

ingress:
  enabled: true
  className: kong
  annotations:
    konghq.com/strip-path: "false"
    konghq.com/plugins: rate-limiting,cors
    cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: pea-forecast.go.th
      paths:
        - path: /api
          pathType: Prefix
          backend: backend
        - path: /
          pathType: Prefix
          backend: frontend
  tls:
    - secretName: pea-forecast-tls
      hosts:
        - pea-forecast.go.th

cors:
  origins:
    - "https://pea-forecast.go.th"
    - "https://www.pea-forecast.go.th"

# ML Service (TOR 7.1.1: AI/ML Server - 16 Core, 64GB)
mlService:
  enabled: true
  replicaCount: 2
  image:
    tag: v1.0.0
  resources:
    requests:
      memory: "16Gi"
      cpu: "8000m"
    limits:
      memory: "64Gi"
      cpu: "16000m"
  env:
    LOG_LEVEL: WARNING
    PYTHONPATH: /app
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilization: 60
    targetMemoryUtilization: 70
  persistence:
    enabled: true
    size: 50Gi
    storageClass: "longhorn"
    modelStorage:
      enabled: true
      size: 20Gi
      storageClass: "longhorn"
  # Schedule on nodes with GPU/high-memory capability
  nodeSelector:
    node-type: ml-server
  tolerations:
    - key: "ml-workload"
      operator: "Equal"
      value: "true"
      effect: "NoSchedule"

monitoring:
  enabled: true
  prometheus:
    scrape: true

# Network Policies - Enable zero-trust networking in production
networkPolicy:
  enabled: true
