# Vault ConfigMap - Server Configuration
# TOR Requirement: 7.1.6 - Key Management per TOR Table 2
apiVersion: v1
kind: ConfigMap
metadata:
  name: vault-config
  namespace: vault
  labels:
    app.kubernetes.io/name: vault
data:
  vault.hcl: |
    # Vault Server Configuration for PEA RE Forecast Platform

    ui = true

    listener "tcp" {
      address = "0.0.0.0:8200"
      tls_disable = true  # Enable TLS in production with cert-manager
    }

    # Storage backend - use Raft for HA in production
    storage "file" {
      path = "/vault/data"
    }

    # API address for cluster communication
    api_addr = "http://vault:8200"
    cluster_addr = "http://vault:8201"

    # Disable memory lock for container environments
    disable_mlock = true

    # Audit logging (TOR 7.1.6 requirement)
    # Enable after initialization:
    # vault audit enable file file_path=/vault/logs/audit.log

    # Telemetry for Prometheus (TOR observability)
    telemetry {
      prometheus_retention_time = "30s"
      disable_hostname = true
    }
