[SERVICE]
    Flush         5
    Daemon        Off
    Log_Level     info
    Parsers_File  parsers.conf
    HTTP_Server   On
    HTTP_Listen   0.0.0.0
    HTTP_Port     2020

# Input: Docker logs
[INPUT]
    Name              tail
    Tag               docker.*
    Path              /var/log/containers/*.log
    Parser            docker
    DB                /var/log/flb_docker.db
    Mem_Buf_Limit     5MB
    Skip_Long_Lines   On
    Refresh_Interval  10

# Input: Application logs
[INPUT]
    Name              tail
    Tag               pea.backend
    Path              /var/log/pea-backend/*.log
    Parser            json
    DB                /var/log/flb_backend.db
    Mem_Buf_Limit     5MB
    Skip_Long_Lines   On
    Refresh_Interval  5

# Filter: Add timestamp if missing
[FILTER]
    Name          record_modifier
    Match         *
    Record        hostname ${HOSTNAME}
    Record        environment production

# Filter: Parse JSON logs
[FILTER]
    Name          parser
    Match         pea.*
    Key_Name      log
    Parser        json
    Reserve_Data  True

# Output: OpenSearch
[OUTPUT]
    Name            opensearch
    Match           *
    Host            opensearch
    Port            9200
    Index           pea-logs
    Type            _doc
    Logstash_Format On
    Logstash_Prefix pea-logs
    Retry_Limit     False
    Suppress_Type_Name On

# Output: Stdout for debugging
[OUTPUT]
    Name   stdout
    Match  pea.*
    Format json_lines
